/*! Jcrop.min.js v2.0.4 - build: 20151117
 *  Copyright 2008-2015 Tapmodo Interactive LLC
 *  Free software under MIT License
 **/!function(e){"use strict";var t=function(n,r){var i=navigator.userAgent.toLowerCase();this.opt=e.extend({},t.defaults,r||{}),this.container=e(n),this.opt.is_msie=/msie/.test(i),this.opt.is_ie_lt9=/msie [1-8]\./.test(i),this.container.addClass(this.opt.css_container),this.ui={},this.state=null,this.ui.multi=[],this.ui.selection=null,this.filter={},this.init(),this.setOptions(r),this.applySizeConstraints(),this.container.trigger("cropinit",this),this.opt.is_ie_lt9&&(this.opt.dragEventTarget=document.body)};e.extend(t,{component:{},filter:{},stage:{},registerComponent:function(e,n){t.component[e]=n},registerFilter:function(e,n){t.filter[e]=n},registerStageType:function(e,n){t.stage[e]=n},attach:function(t,n){var r=new e.Jcrop(t,n);return r},imgCopy:function(e){var t=new Image;return t.src=e.src,t},imageClone:function(n){return e.Jcrop.supportsCanvas?t.canvasClone(n):t.imgCopy(n)},canvasClone:function(t){var n=document.createElement("canvas"),r=n.getContext("2d");return e(n).width(t.width).height(t.height),n.width=t.naturalWidth,n.height=t.naturalHeight,r.drawImage(t,0,0,t.naturalWidth,t.naturalHeight),n},propagate:function(e,t,n){for(var r=0,i=e.length;i>r;r++)t.hasOwnProperty(e[r])&&(n[e[r]]=t[e[r]])},getLargestBox:function(e,t,n){return t/n>e?[n*e,n]:[t,t/e]},stageConstructor:function(n,r,i){var s=[];e.each(t.stage,function(e,t){s.push(t)}),s.sort(function(e,t){return e.priority-t.priority});for(var o=0,u=s.length;u>o;o++)if(s[o].isSupported(n,r)){s[o].create(n,r,function(e,t){"function"==typeof i&&i(e,t)});break}},supportsColorFade:function(){return e.fx.step.hasOwnProperty("backgroundColor")},wrapFromXywh:function(e){var t={x:e[0],y:e[1],w:e[2],h:e[3]};return t.x2=t.x+t.w,t.y2=t.y+t.h,t}});var r=function(){};e.extend(r,{isSupported:function(e,t){return!0},priority:100,create:function(e,t,n){var i=new r;i.element=e,n.call(this,i,t)},prototype:{attach:function(e){this.init(e),e.ui.stage=this},triggerEvent:function(t){return e(this.element).trigger(t),this},getElement:function(){return this.element}}}),t.registerStageType("Block",r);var i=function(){};i.prototype=new r,e.extend(i,{isSupported:function(e,t){return"IMG"==e.tagName?!0:void 0},priority:90,create:function(t,n,r){e.Jcrop.component.ImageLoader.attach(t,function(s,o){var u=new i;u.element=e(t).wrap("<div />").parent(),u.element.width(s).height(o),u.imgsrc=t,"function"==typeof r&&r.call(this,u,n)})}}),t.registerStageType("Image",i);var s=function(){this.angle=0,this.scale=1,this.scaleMin=.2,this.scaleMax=1.25,this.offset=[0,0]};s.prototype=new i,e.extend(s,{isSupported:function(t,n){return e.Jcrop.supportsCanvas&&"IMG"==t.tagName?!0:void 0},priority:60,create:function(t,n,r){var i=e(t),o=e.extend({},n);e.Jcrop.component.ImageLoader.attach(t,function(e,n){var u=new s;i.hide(),u.createCanvas(t,e,n),i.before(u.element),u.imgsrc=t,o.imgsrc=t,"function"==typeof r&&(r(u,o),u.redraw())})}}),e.extend(s.prototype,{init:function(e){this.core=e},setOffset:function(e,t){return this.offset=[e,t],this},setAngle:function(e){return this.angle=e,this},setScale:function(e){return this.scale=this.boundScale(e),this},boundScale:function(e){return e<this.scaleMin?e=this.scaleMin:e>this.scaleMax&&(e=this.scaleMax),e},createCanvas:function(t,n,r){this.width=n,this.height=r,this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=r,this.$canvas=e(this.canvas).width("100%").height("100%"),this.context=this.canvas.getContext("2d"),this.fillstyle="rgb(0,0,0)",this.element=this.$canvas.wrap("<div />").parent().width(n).height(r)},triggerEvent:function(e){return this.$canvas.trigger(e),this},clear:function(){return this.context.fillStyle=this.fillstyle,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this},redraw:function(){return this.context.save(),this.clear(),this.context.translate(parseInt(.5*this.width),parseInt(.5*this.height)),this.context.translate(this.offset[0]/this.core.opt.xscale,this.offset[1]/this.core.opt.yscale),this.context.rotate(this.angle*(Math.PI/180)),this.context.scale(this.scale,this.scale),this.context.translate(-parseInt(.5*this.width),-parseInt(.5*this.height)),this.context.drawImage(this.imgsrc,0,0,this.width,this.height),this.context.restore(),this.$canvas.trigger("cropredraw"),this},setFillStyle:function(e){return this.fillstyle=e,this}}),t.registerStageType("Canvas",s);var o=function(){this.minw=40,this.minh=40,this.maxw=0,this.maxh=0,this.core=null};e.extend(o.prototype,{tag:"backoff",priority:22,filter:function(e){var t=this.bound;return e.x<t.minx&&(e.x=t.minx,e.x2=e.w+e.x),e.y<t.miny&&(e.y=t.miny,e.y2=e.h+e.y),e.x2>t.maxx&&(e.x2=t.maxx,e.x=e.x2-e.w),e.y2>t.maxy&&(e.y2=t.maxy,e.y=e.y2-e.h),e},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.bound={minx:0+e.edge.w,miny:0+e.edge.n,maxx:this.elw+e.edge.e,maxy:this.elh+e.edge.s}}}),t.registerFilter("backoff",o);var u=function(){this.core=null};e.extend(u.prototype,{tag:"constrain",priority:5,filter:function(e,t){return"move"==t?(e.x<this.minx&&(e.x=this.minx,e.x2=e.w+e.x),e.y<this.miny&&(e.y=this.miny,e.y2=e.h+e.y),e.x2>this.maxx&&(e.x2=this.maxx,e.x=e.x2-e.w),e.y2>this.maxy&&(e.y2=this.maxy,e.y=e.y2-e.h)):(e.x<this.minx&&(e.x=this.minx),e.y<this.miny&&(e.y=this.miny),e.x2>this.maxx&&(e.x2=this.maxx),e.y2>this.maxy&&(e.y2=this.maxy)),e.w=e.x2-e.x,e.h=e.y2-e.y,e},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.minx=0+e.edge.w,this.miny=0+e.edge.n,this.maxx=this.elw+e.edge.e,this.maxy=this.elh+e.edge.s}}),t.registerFilter("constrain",u);var a=function(){this.core=null};e.extend(a.prototype,{tag:"extent",priority:12,offsetFromCorner:function(e,t,n){var r=t[0],i=t[1];switch(e){case"bl":return[n.x2-r,n.y,r,i];case"tl":return[n.x2-r,n.y2-i,r,i];case"br":return[n.x,n.y,r,i];case"tr":return[n.x,n.y2-i,r,i]}},getQuadrant:function(e){var t=e.opposite[0]-e.offsetx,n=e.opposite[1]-e.offsety;return 0>t&&0>n?"br":t>=0&&n>=0?"tl":0>t&&n>=0?"tr":"bl"},filter:function(e,n,r){if("move"==n)return e;var i=e.w,s=e.h,o=r.state,u=this.limits,a=o?this.getQuadrant(o):"br";return u.minw&&i<u.minw&&(i=u.minw),u.minh&&s<u.minh&&(s=u.minh),u.maxw&&i>u.maxw&&(i=u.maxw),u.maxh&&s>u.maxh&&(s=u.maxh),i==e.w&&s==e.h?e:t.wrapFromXywh(this.offsetFromCorner(a,[i,s],e))},refresh:function(e){this.elw=e.core.container.width(),this.elh=e.core.container.height(),this.limits={minw:e.minSize[0],minh:e.minSize[1],maxw:e.maxSize[0],maxh:e.maxSize[1]}}}),t.registerFilter("extent",a);var f=function(){this.stepx=1,this.stepy=1,this.core=null};e.extend(f.prototype,{tag:"grid",priority:19,filter:function(e){var t={x:Math.round(e.x/this.stepx)*this.stepx,y:Math.round(e.y/this.stepy)*this.stepy,x2:Math.round(e.x2/this.stepx)*this.stepx,y2:Math.round(e.y2/this.stepy)*this.stepy};return t.w=t.x2-t.x,t.h=t.y2-t.y,t}}),t.registerFilter("grid",f);var l=function(){this.ratio=0,this.core=null};e.extend(l.prototype,{tag:"ratio",priority:15,offsetFromCorner:function(e,t,n){var r=t[0],i=t[1];switch(e){case"bl":return[n.x2-r,n.y,r,i];case"tl":return[n.x2-r,n.y2-i,r,i];case"br":return[n.x,n.y,r,i];case"tr":return[n.x,n.y2-i,r,i]}},getBoundRatio:function(e,n){var r=t.getLargestBox(this.ratio,e.w,e.h);return t.wrapFromXywh(this.offsetFromCorner(n,r,e))},getQuadrant:function(e){var t=e.opposite[0]-e.offsetx,n=e.opposite[1]-e.offsety;return 0>t&&0>n?"br":t>=0&&n>=0?"tl":0>t&&n>=0?"tr":"bl"},filter:function(e,t,n){if(!this.ratio)return e;var r=(e.w/e.h,n.state),i=r?this.getQuadrant(r):"br";if(t=t||"se","move"==t)return e;switch(t){case"n":e.x2=this.elw,e.w=e.x2-e.x,i="tr";break;case"s":e.x2=this.elw,e.w=e.x2-e.x,i="br";break;case"e":e.y2=this.elh,e.h=e.y2-e.y,i="br";break;case"w":e.y2=this.elh,e.h=e.y2-e.y,i="bl"}return this.getBoundRatio(e,i)},refresh:function(e){this.ratio=e.aspectRatio,this.elw=e.core.container.width(),this.elh=e.core.container.height()}}),t.registerFilter("ratio",l);var c=function(){this.core=null};e.extend(c.prototype,{tag:"round",priority:90,filter:function(e){var t={x:Math.round(e.x),y:Math.round(e.y),x2:Math.round(e.x2),y2:Math.round(e.y2)};return t.w=t.x2-t.x,t.h=t.y2-t.y,t}}),t.registerFilter("round",c);var h=function(e,t){this.color=t||"black",this.opacity=e||.5,this.core=null,this.shades={}};e.extend(h.prototype,{tag:"shader",fade:!0,fadeEasing:"swing",fadeSpeed:320,priority:95,init:function(){var t=this;t.attached||(t.visible=!1,t.container=e("<div />").addClass(t.core.opt.css_shades).prependTo(this.core.container).hide(),t.elh=this.core.container.height(),t.elw=this.core.container.width(),t.shades={top:t.createShade(),right:t.createShade(),left:t.createShade(),bottom:t.createShade()},t.attached=!0)},destroy:function(){this.container.remove()},setColor:function(n,r){var i=this;if(n==i.color)return i;this.color=n;var s=t.supportsColorFade();return e.each(i.shades,function(e,t){i.fade&&!r&&s?t.animate({backgroundColor:n},{queue:!1,duration:i.fadeSpeed,easing:i.fadeEasing}):t.css("backgroundColor",n)}),i},setOpacity:function(t,n){var r=this;return t==r.opacity?r:(r.opacity=t,e.each(r.shades,function(e,i){!r.fade||n?i.css({opacity:t}):i.animate({opacity:t},{queue:!1,duration:r.fadeSpeed,easing:r.fadeEasing})}),r)},createShade:function(){return e("<div />").css({position:"absolute",backgroundColor:this.color,opacity:this.opacity}).appendTo(this.container)},refresh:function(e){var t=this.core,n=this.shades;this.setColor(e.bgColor?e.bgColor:this.core.opt.bgColor),this.setOpacity(e.bgOpacity?e.bgOpacity:this.core.opt.bgOpacity),this.elh=t.container.height(),this.elw=t.container.width(),n.right.css("height",this.elh+"px"),n.left.css("height",this.elh+"px")},filter:function(e,t,n){if(!n.active)return e;var r=this,i=r.shades;return i.top.css({left:Math.round(e.x)+"px",width:Math.round(e.w)+"px",height:Math.round(e.y)+"px"}),i.bottom.css({top:Math.round(e.y2)+"px",left:Math.round(e.x)+"px",width:Math.round(e.w)+"px",height:r.elh-Math.round(e.y2)+"px"}),i.right.css({left:Math.round(e.x2)+"px",width:r.elw-Math.round(e.x2)+"px"}),i.left.css({width:Math.round(e.x)+"px"}),r.visible||(r.container.show(),r.visible=!0),e}}),t.registerFilter("shader",h);var p=function(e){this.stage=e,this.core=e.core,this.cloneStagePosition()};p.prototype={cloneStagePosition:function(){var e=this.stage;this.angle=e.angle,this.scale=e.scale,this.offset=e.offset},getElement:function(){var t=this.stage;return e("<div />").css({position:"absolute",top:t.offset[0]+"px",left:t.offset[1]+"px",width:t.angle+"px",height:t.scale+"px"})},animate:function(e){var t=this;this.scale=this.stage.boundScale(this.scale),t.stage.triggerEvent("croprotstart"),t.getElement().animate({top:t.offset[0]+"px",left:t.offset[1]+"px",width:t.angle+"px",height:t.scale+"px"},{easing:t.core.opt.animEasing,duration:t.core.opt.animDuration,complete:function(){t.stage.triggerEvent("croprotend"),"function"==typeof e&&e.call(this)},progress:function(e){var n,r={},i=e.tweens;for(n=0;n<i.length;n++)r[i[n].prop]=i[n].now;t.stage.setAngle(r.width).setScale(r.height).setOffset(r.top,r.left).redraw()}})}},t.stage.Canvas.prototype.getAnimator=function(){return new p(this)},t.registerComponent("CanvasAnimator",p);var d=function(e){this.selection=e,this.core=e.core};d.prototype={getElement:function(){var t=this.selection.get();return e("<div />").css({position:"absolute",top:t.y+"px",left:t.x+"px",width:t.w+"px",height:t.h+"px"})},animate:function(e,t,n,r,i){var s=this;s.selection.allowResize(!1),s.getElement().animate({top:t+"px",left:e+"px",width:n+"px",height:r+"px"},{easing:s.core.opt.animEasing,duration:s.core.opt.animDuration,complete:function(){s.selection.allowResize(!0),i&&i.call(this)},progress:function(e){var t,n={},r=e.tweens;for(t=0;t<r.length;t++)n[r[t].prop]=r[t].now;var i={x:parseInt(n.left),y:parseInt(n.top),w:parseInt(n.width),h:parseInt(n.height)};i.x2=i.x+i.w,i.y2=i.y+i.h,s.selection.updateRaw(i,"se")}})}},t.registerComponent("Animator",d);var v=function(e,t,n){var r=this;r.x=e.pageX,r.y=e.pageY,r.selection=t,r.eventTarget=t.core.opt.dragEventTarget,r.orig=t.get(),t.callFilterFunction("refresh");var i=t.core.container.position();r.elx=i.left,r.ely=i.top,r.offsetx=0,r.offsety=0,r.ord=n,r.opposite=r.getOppositeCornerOffset(),r.initEvents(e)};v.prototype={getOppositeCornerOffset:function(){var e=this.orig,t=this.x-this.elx-e.x,n=this.y-this.ely-e.y;switch(this.ord){case"nw":case"w":return[e.w-t,e.h-n];case"sw":return[e.w-t,-n];case"se":case"s":case"e":return[-t,-n];case"ne":case"n":return[-t,e.h-n]}return[null,null]},initEvents:function(t){e(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())},dragEvent:function(e){this.offsetx=e.pageX-this.x,this.offsety=e.pageY-this.y,this.selection.updateRaw(this.getBox(),this.ord)},endDragEvent:function(e){var t=this.selection;t.core.container.removeClass("jcrop-dragging"),t.element.trigger("cropend",[t,t.core.unscale(t.get())]),t.focus()},createStopHandler:function(){var t=this;return function(n){return e(t.eventTarget).off(".jcrop"),t.endDragEvent(n),!1}},createDragHandler:function(){var e=this;return function(t){return e.dragEvent(t),!1}},update:function(e,t){var n=this;n.offsetx=e-n.x,n.offsety=t-n.y},resultWrap:function(e){var t={x:Math.min(e[0],e[2]),y:Math.min(e[1],e[3]),x2:Math.max(e[0],e[2]),y2:Math.max(e[1],e[3])};return t.w=t.x2-t.x,t.h=t.y2-t.y,t},getBox:function(){var e=this,t=e.orig,n={x2:t.x+t.w,y2:t.y+t.h};switch(e.ord){case"n":return e.resultWrap([t.x,e.offsety+t.y,n.x2,n.y2]);case"s":return e.resultWrap([t.x,t.y,n.x2,e.offsety+n.y2]);case"e":return e.resultWrap([t.x,t.y,e.offsetx+n.x2,n.y2]);case"w":return e.resultWrap([t.x+e.offsetx,t.y,n.x2,n.y2]);case"sw":return e.resultWrap([e.offsetx+t.x,t.y,n.x2,e.offsety+n.y2]);case"se":return e.resultWrap([t.x,t.y,e.offsetx+n.x2,e.offsety+n.y2]);case"ne":return e.resultWrap([t.x,e.offsety+t.y,e.offsetx+n.x2,n.y2]);case"nw":return e.resultWrap([e.offsetx+t.x,e.offsety+t.y,n.x2,n.y2]);case"move":return n.nx=t.x+e.offsetx,n.ny=t.y+e.offsety,e.resultWrap([n.nx,n.ny,n.nx+t.w,n.ny+t.h])}}},t.registerComponent("DragState",v);var m=function(e){this.core=e};m.prototype={on:function(t,n){e(this).on(t,n)},off:function(t){e(this).off(t)},trigger:function(t){e(this).trigger(t)}},t.registerComponent("EventManager",m);var g=function(e,t,n){this.src=e,t||(t=new Image),this.element=t,this.callback=n,this.load()};e.extend(g,{attach:function(e,t){return new g(e.src,e,t)},prototype:{getDimensions:function(){var e=this.element;return e.naturalWidth?[e.naturalWidth,e.naturalHeight]:e.width?[e.width,e.height]:null},fireCallback:function(){this.element.onload=null,"function"==typeof this.callback&&this.callback.apply(this,this.getDimensions())},isLoaded:function(){return this.element.complete},load:function(){var e=this,t=e.element;t.src=e.src,e.isLoaded()?e.fireCallback():e.element.onload=function(t){e.fireCallback()}}}}),t.registerComponent("ImageLoader",g);var y=function(e){this.core=e,this.init()};e.extend(y,{support:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:void 0},prototype:{init:function(){var t=this,n=e.Jcrop.component.DragState.prototype;n.touch||(t.initEvents(),t.shimDragState(),t.shimStageDrag(),n.touch=!0)},shimDragState:function(){var t=this;e.Jcrop.component.DragState.prototype.initEvents=function(n){"touch"==n.type.substr(0,5)?e(this.eventTarget).on("touchmove.jcrop.jcrop-touch",t.dragWrap(this.createDragHandler())).on("touchend.jcrop.jcrop-touch",this.createStopHandler()):e(this.eventTarget).on("mousemove.jcrop",this.createDragHandler()).on("mouseup.jcrop",this.createStopHandler())}},shimStageDrag:function(){this.core.container.addClass("jcrop-touch").on("touchstart.jcrop.jcrop-stage",this.dragWrap(this.core.ui.manager.startDragHandler()))},dragWrap:function(e){return function(t){return t.preventDefault(),t.stopPropagation(),"touch"==t.type.substr(0,5)?(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY,e(t)):!1}},initEvents:function(){var e=this,t=e.core;t.container.on("touchstart.jcrop.jcrop-touch","."+t.opt.css_drag,e.dragWrap(t.startDrag()))}}}),t.registerComponent("Touch",y);var b=function(e){this.core=e,this.init()};e.extend(b,{defaults:{eventName:"keydown.jcrop",passthru:[9],debug:!1},prototype:{init:function(){e.extend(this,b.defaults),this.enable()},disable:function(){this.core.container.off(this.eventName)},enable:function(){var t=this,n=t.core;n.container.on(t.eventName,function(r){var i=r.shiftKey?16:2;if(e.inArray(r.keyCode,t.passthru)>=0)return!0;switch(r.keyCode){case 37:n.nudge(-i,0);break;case 38:n.nudge(0,-i);break;case 39:n.nudge(i,0);break;case 40:n.nudge(0,i);break;case 46:case 8:return n.requestDelete(),!1;default:t.debug&&console.log("keycode: "+r.keyCode)}r.metaKey||r.ctrlKey||r.preventDefault()})}}}),t.registerComponent("Keyboard",b);var w=function(){};e.extend(w,{defaults:{minSize:[8,8],maxSize:[0,0],aspectRatio:0,edge:{n:0,s:0,e:0,w:0},bgColor:null,bgOpacity:null,last:null,state:null,active:!0,linked:!0,canDelete:!0,canDrag:!0,canResize:!0,canSelect:!0},prototype:{init:function(e){this.core=e,this.startup(),this.linked=this.core.opt.linked,this.attach(),this.setOptions(this.core.opt),e.container.trigger("cropcreate",[this])},attach:function(){},startup:function(){var t=this,n=t.core.opt;e.extend(t,w.defaults),t.filter=t.core.getDefaultFilters(),t.element=e("<div />").addClass(n.css_selection).data({selection:t}),t.frame=e("<button />").addClass(n.css_button).data("ord","move").attr("type","button"),t.element.append(t.frame).appendTo(t.core.container),t.core.opt.is_msie&&t.frame.css({opacity:0,backgroundColor:"white"}),t.insertElements(),t.frame.on("focus.jcrop",function(e){t.core.setSelection(t),t.element.trigger("cropfocus",t),t.element.addClass("jcrop-focus")}).on("blur.jcrop",function(e){t.element.removeClass("jcrop-focus"),t.element.trigger("cropblur",t)})},propagate:["canDelete","canDrag","canResize","canSelect","minSize","maxSize","aspectRatio","edge"],setOptions:function(e){return t.propagate(this.propagate,e,this),this.refresh(),this},refresh:function(){this.allowResize(),this.allowDrag(),this.allowSelect(),this.callFilterFunction("refresh"),this.updateRaw(this.get(),"se")},callFilterFunction:function(e,t){for(var n=0;n<this.filter.length;n++)this.filter[n][e]&&this.filter[n][e](this);return this},addFilter:function(e){e.core=this.core,this.hasFilter(e)||(this.filter.push(e),this.sortFilters(),e.init&&e.init(),this.refresh())},hasFilter:function(e){var t,n=this.filter;for(t=0;t<n.length;t++)if(n[t]===e)return!0},sortFilters:function(){this.filter.sort(function(e,t){return e.priority-t.priority})},clearFilters:function(){for(var e,t=this.filter,e=0;e<t.length;e++)t[e].destroy&&t[e].destroy();this.filter=[]},removeFilter:function(e){for(var t,n=this.filter,r=[],t=0;t<n.length;t++)n[t].tag&&n[t].tag==e||e===n[t]?n[t].destroy&&n[t].destroy():r.push(n[t]);this.filter=r},runFilters:function(e,t){for(var n=0;n<this.filter.length;n++)e=this.filter[n].filter(e,t,this);return e},endDrag:function(){this.state&&(e(document.body).off(".jcrop"),this.focus(),this.state=null)},startDrag:function(n,r){var i=this;return i.core,r=r||e(n.target).data("ord"),this.focus(),"move"==r&&i.element.hasClass(i.core.opt.css_nodrag)?!1:(this.state=new t.component.DragState(n,this,r),!1)},allowSelect:function(e){return void 0===e&&(e=this.canSelect),e&&this.canSelect?this.frame.attr("disabled",!1):this.frame.attr("disabled","disabled"),this},allowDrag:function(e){var t=this,n=t.core.opt;return void 0==e&&(e=t.canDrag),e&&t.canDrag?t.element.removeClass(n.css_nodrag):t.element.addClass(n.css_nodrag),this},allowResize:function(e){var t=this,n=t.core.opt;return void 0==e&&(e=t.canResize),e&&t.canResize?t.element.removeClass(n.css_noresize):t.element.addClass(n.css_noresize),this},remove:function(){this.element.trigger("cropremove",this),this.element.remove()},toBack:function(){this.active=!1,this.element.removeClass("jcrop-current jcrop-focus")},toFront:function(){this.active=!0,this.element.addClass("jcrop-current"),this.callFilterFunction("refresh"),this.refresh()},redraw:function(e){return this.moveTo(e.x,e.y),this.resize(e.w,e.h),this.last=e,this},update:function(e,t){return this.updateRaw(this.core.scale(e),t)},updateRaw:function(e,t){return e=this.runFilters(e,t),this.redraw(e),this.element.trigger("cropmove",[this,this.core.unscale(e)]),this},animateTo:function(e,n){var r=new t.component.Animator(this),i=this.core.scale(t.wrapFromXywh(e));r.animate(i.x,i.y,i.w,i.h,n)},center:function(e){var t=this.get(),n=this.core,r=n.container.width(),i=n.container.height(),s=[(r-t.w)/2,(i-t.h)/2,t.w,t.h];return this[e?"setSelect":"animateTo"](s)},createElement:function(t,n){return e("<div />").addClass(t+" ord-"+n).data("ord",n)},moveTo:function(e,t){this.element.css({top:t+"px",left:e+"px"})},blur:function(){return this.element.blur(),this},focus:function(){return this.core.setSelection(this),this.frame.focus(),this},resize:function(e,t){this.element.css({width:e+"px",height:t+"px"})},get:function(){var e=this.element,t=e.position(),n=e.width(),r=e.height(),i={x:t.left,y:t.top};return i.x2=i.x+n,i.y2=i.y+r,i.w=n,i.h=r,i},insertElements:function(){var e,t=this,n=(t.core,t.element),r=t.core.opt,i=r.borders,s=r.handles,o=r.dragbars;for(e=0;e<o.length;e++)n.append(t.createElement(r.css_dragbars,o[e]));for(e=0;e<s.length;e++)n.append(t.createElement(r.css_handles,s[e]));for(e=0;e<i.length;e++)n.append(t.createElement(r.css_borders,i[e]))}}}),t.registerComponent("Selection",w);var E=function(t,n){e.extend(this,E.defaults,n||{}),this.manager=t,this.core=t.core};E.defaults={offset:[-8,-8],active:!0,minsize:[20,20]},e.extend(E.prototype,{start:function(n){var r=this.core;if(r.opt.allowSelect){if(r.opt.multi&&r.opt.multiMax&&r.ui.multi.length>=r.opt.multiMax)return!1;var i=e(n.currentTarget).offset(),s=n.pageX-i.left+this.offset[0],o=n.pageY-i.top+this.offset[1],u=r.ui.multi;if(!r.opt.multi)if(r.opt.multiCleanup){for(var a=0;a<u.length;a++)u[a].remove();r.ui.multi=[]}else r.removeSelection(r.ui.selection);r.container.addClass("jcrop-dragging");var f=r.newSelection().updateRaw(t.wrapFromXywh([s,o,1,1]));return f.element.trigger("cropstart",[f,this.core.unscale(f.get())]),f.startDrag(n,"se")}},end:function(e,t){this.drag(e,t);var n=this.sel.get();this.core.container.removeClass("jcrop-dragging"),n.w<this.minsize[0]||n.h<this.minsize[1]?this.core.requestDelete():this.sel.focus()}}),t.registerComponent("StageDrag",E);var S=function(e){this.core=e,this.ui=e.ui,this.init()};e.extend(S.prototype,{init:function(){this.setupEvents(),this.dragger=new E(this)},tellConfigUpdate:function(e){for(var t=0,n=this.ui.multi,r=n.length;r>t;t++)n[t].setOptions&&(n[t].linked||this.core.opt.linkCurrent&&n[t]==this.ui.selection)&&n[t].setOptions(e)},startDragHandler:function(){var e=this;return function(t){return!t.button||e.core.opt.is_ie_lt9?e.dragger.start(t):void 0}},removeEvents:function(){this.core.event.off(".jcrop-stage"),this.core.container.off(".jcrop-stage")},shimLegacyHandlers:function(t){var n,r=this.core;e.each(r.opt.legacyHandlers,function(e,i){e in t&&(n=t[e],r.container.off(".jcrop-"+e).on(i+".jcrop.jcrop-"+e,function(e,t,i){n.call(r,i)}),delete t[e])})},setupEvents:function(){var e=this,t=e.core;t.event.on("configupdate.jcrop-stage",function(n){e.shimLegacyHandlers(t.opt),e.tellConfigUpdate(t.opt),t.container.trigger("cropconfig",[t,t.opt])}),this.core.container.on("mousedown.jcrop.jcrop-stage",this.startDragHandler())}}),t.registerComponent("StageManager",S);var x=function(){};e.extend(x,{defaults:{selection:null,fading:!0,fadeDelay:1e3,fadeDuration:1e3,autoHide:!1,width:80,height:80,_hiding:null},prototype:{recopyCanvas:function(){var e=this.core.ui.stage,t=e.context;this.context.putImageData(t.getImageData(0,0,e.canvas.width,e.canvas.height),0,0)},init:function(t,n){var r=this;this.core=t,e.extend(this,x.defaults,n),r.initEvents(),r.refresh(),r.insertElements(),r.selection?(r.renderSelection(r.selection),r.selectionTarget=r.selection.element[0]):r.core.ui.selection&&r.renderSelection(r.core.ui.selection),r.core.ui.stage.canvas&&(r.context=r.preview[0].getContext("2d"),r.core.container.on("cropredraw",function(e){r.recopyCanvas(),r.refresh()}))},updateImage:function(t){return this.preview.remove(),this.preview=e(e.Jcrop.imageClone(t)),this.element.append(this.preview),this.refresh(),this},insertElements:function(){this.preview=e(e.Jcrop.imageClone(this.core.ui.stage.imgsrc)),this.element=e("<div />").addClass("jcrop-thumb").width(this.width).height(this.height).append(this.preview).appendTo(this.core.container)},resize:function(e,t){this.width=e,this.height=t,this.element.width(e).height(t),this.renderCoords(this.last)},refresh:function(){this.cw=this.core.opt.xscale*this.core.container.width(),this.ch=this.core.opt.yscale*this.core.container.height(),this.last&&this.renderCoords(this.last)},renderCoords:function(e){var t=this.width/e.w,n=this.height/e.h;return this.preview.css({width:Math.round(t*this.cw)+"px",height:Math.round(n*this.ch)+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(n*e.y)+"px"}),this.last=e,this},renderSelection:function(e){return this.renderCoords(e.core.unscale(e.get()))},selectionStart:function(e){this.renderSelection(e)},show:function(){this._hiding&&clearTimeout(this._hiding),this.fading?this.element.stop().animate({opacity:1},{duration:80,queue:!1}):this.element.stop().css({opacity:1})},hide:function(){var e=this;e.fading?e._hiding=setTimeout(function(){e._hiding=null,e.element.stop().animate({opacity:0},{duration:e.fadeDuration,queue:!1})},e.fadeDelay):e.element.hide()},initEvents:function(){var e=this;e.core.container.on("croprotstart croprotend cropimage cropstart cropmove cropend",function(t,n,r){if(e.selectionTarget&&e.selectionTarget!==t.target)return!1;switch(t.type){case"cropimage":e.updateImage(r);break;case"cropstart":e.selectionStart(n);case"croprotstart":e.show();break;case"cropend":e.renderCoords(r);case"croprotend":e.autoHide&&e.hide();break;case"cropmove":e.renderCoords(r)}})}}}),t.registerComponent("Thumbnailer",x);var T=function(){};T.prototype={init:function(t,n,r){n||(n=t.container),this.$btn=e(n),this.$targ=e(n),this.core=t,this.$btn.addClass("dialdrag").on("mousedown.dialdrag",this.mousedown()).data("dialdrag",this),e.isFunction(r)||(r=function(){}),this.callback=r,this.ondone=r},remove:function(){return this.$btn.removeClass("dialdrag").off(".dialdrag").data("dialdrag",null),this},setTarget:function(t){return this.$targ=e(t),this},getOffset:function(){var e=this.$targ,t=e.offset();return[t.left+e.width()/2,t.top+e.height()/2]},relMouse:function(e){var t=e.pageX-this.offset[0],n=e.pageY-this.offset[1],r=Math.atan2(n,t)*(180/Math.PI),i=Math.sqrt(Math.pow(t,2)+Math.pow(n,2));return[t,n,r,i]},mousedown:function(){function t(t){e(window).off(".dialdrag"),r.ondone.call(r,r.relMouse(t)),r.core.container.trigger("croprotend")}function n(e){r.callback.call(r,r.relMouse(e))}var r=this;return function(i){r.offset=r.getOffset();var s=r.relMouse(i);return r.angleOffset=-r.core.ui.stage.angle+s[2],r.distOffset=s[3],r.dragOffset=[s[0],s[1]],r.core.container.trigger("croprotstart"),e(window).on("mousemove.dialdrag",n).on("mouseup.dialdrag",t),r.callback.call(r,r.relMouse(i)),!1}}},t.registerComponent("DialDrag",T),t.defaults={edge:{n:0,s:0,e:0,w:0},setSelect:null,linked:!0,linkCurrent:!0,canDelete:!0,canSelect:!0,canDrag:!0,canResize:!0,eventManagerComponent:t.component.EventManager,keyboardComponent:t.component.Keyboard,dragstateComponent:t.component.DragState,stagemanagerComponent:t.component.StageManager,animatorComponent:t.component.Animator,selectionComponent:t.component.Selection,stageConstructor:t.stageConstructor,allowSelect:!0,multi:!1,multiMax:!1,multiCleanup:!0,animation:!0,animEasing:"swing",animDuration:400,fading:!0,fadeDuration:300,fadeEasing:"swing",bgColor:"black",bgOpacity:.5,applyFilters:["constrain","extent","backoff","ratio","shader","round"],borders:["e","w","s","n"],handles:["n","s","e","w","sw","ne","nw","se"],dragbars:["n","e","w","s"],dragEventTarget:window,xscale:1,yscale:1,boxWidth:null,boxHeight:null,css_nodrag:"jcrop-nodrag",css_drag:"jcrop-drag",css_container:"jcrop-active",css_shades:"jcrop-shades",css_selection:"jcrop-selection",css_borders:"jcrop-border",css_handles:"jcrop-handle jcrop-drag",css_button:"jcrop-box jcrop-drag",css_noresize:"jcrop-noresize",css_dragbars:"jcrop-dragbar jcrop-drag",legacyHandlers:{onChange:"cropmove",onSelect:"cropend"}},e.extend(t.prototype,{init:function(){this.event=new this.opt.eventManagerComponent(this),this.ui.keyboard=new this.opt.keyboardComponent(this),this.ui.manager=new this.opt.stagemanagerComponent(this),this.applyFilters(),e.Jcrop.supportsTouch&&new e.Jcrop.component.Touch(this),this.initEvents()},applySizeConstraints:function(){var n=this.opt,r=this.opt.imgsrc;if(r){var i=r.naturalWidth||r.width,s=r.naturalHeight||r.height,o=n.boxWidth||i,u=n.boxHeight||s;if(r&&(i>o||s>u)){var a=t.getLargestBox(i/s,o,u);e(r).width(a[0]).height(a[1]),this.resizeContainer(a[0],a[1]),this.opt.xscale=i/a[0],this.opt.yscale=s/a[1]}}if(this.opt.trueSize){var f=this.opt.trueSize[0],l=this.opt.trueSize[1],c=this.getContainerSize();this.opt.xscale=f/c[0],this.opt.yscale=l/c[1]}},initComponent:function(e){if(t.component[e]){var n=Array.prototype.slice.call(arguments),r=new t.component[e];return n.shift(),n.unshift(this),r.init.apply(r,n),r}},setOptions:function(t,n){return e.isPlainObject(t)||(t={}),e.extend(this.opt,t),this.opt.setSelect&&(this.ui.multi.length||this.newSelection(),this.setSelect(this.opt.setSelect),this.opt.setSelect=null),this.event.trigger("configupdate"),this},destroy:function(){this.opt.imgsrc?(this.container.before(this.opt.imgsrc),this.container.remove(),e(this.opt.imgsrc).removeData("Jcrop").show()):this.container.remove()},applyFilters:function(){for(var t,n=0,r=this.opt.applyFilters,i=r.length;i>n;n++)e.Jcrop.filter[r[n]]&&(t=new e.Jcrop.filter[r[n]]),t.core=this,t.init&&t.init(),this.filter[r[n]]=t},getDefaultFilters:function(){for(var e=[],t=0,n=this.opt.applyFilters,r=n.length;r>t;t++)this.filter.hasOwnProperty(n[t])&&e.push(this.filter[n[t]]);return e.sort(function(e,t){return e.priority-t.priority}),e},setSelection:function(e){for(var t=this.ui.multi,n=[],r=0;r<t.length;r++)t[r]!==e&&n.push(t[r]),t[r].toBack();return n.unshift(e),this.ui.multi=n,this.ui.selection=e,e.toFront(),e},getSelection:function(e){var t=this.ui.selection.get();return t},newSelection:function(e){return e||(e=new this.opt.selectionComponent),e.init(this),this.setSelection(e),e},hasSelection:function(e){for(var t=0;t<this.ui.multi;t++)if(e===this.ui.multi[t])return!0},removeSelection:function(e){for(var t,n=[],r=this.ui.multi,t=0;t<r.length;t++)e!==r[t]?n.push(r[t]):r[t].remove();return this.ui.multi=n},addFilter:function(e){for(var t=0,n=this.ui.multi,r=n.length;r>t;t++)n[t].addFilter(e);return this},removeFilter:function(e){for(var t=0,n=this.ui.multi,r=n.length;r>t;t++)n[t].removeFilter(e);return this},blur:function(){return this.ui.selection.blur(),this},focus:function(){return this.ui.selection.focus(),this},initEvents:function(){var e=this;e.container.on("selectstart",function(e){return!1}).on("mousedown","."+e.opt.css_drag,e.startDrag())},maxSelect:function(){this.setSelect([0,0,this.elw,this.elh])},nudge:function(e,t){var n=this.ui.selection,r=n.get();r.x+=e,r.x2+=e,r.y+=t,r.y2+=t,r.x<0?(r.x2=r.w,r.x=0):r.x2>this.elw&&(r.x2=this.elw,r.x=r.x2-r.w),r.y<0?(r.y2=r.h,r.y=0):r.y2>this.elh&&(r.y2=this.elh,r.y=r.y2-r.h),n.element.trigger("cropstart",[n,this.unscale(r)]),n.updateRaw(r,"move"),n.element.trigger("cropend",[n,this.unscale(r)])},refresh:function(){for(var e=0,t=this.ui.multi,n=t.length;n>e;e++)t[e].refresh()},blurAll:function(){for(var e=this.ui.multi,t=0;t<e.length;t++)e[t]!==sel&&n.push(e[t]),e[t].toBack()},scale:function(e){var t=this.opt.xscale,n=this.opt.yscale;return{x:e.x/t,y:e.y/n,x2:e.x2/t,y2:e.y2/n,w:e.w/t,h:e.h/n}},unscale:function(e){var t=this.opt.xscale,n=this.opt.yscale;return{x:e.x*t,y:e.y*n,x2:e.x2*t,y2:e.y2*n,w:e.w*t,h:e.h*n}},requestDelete:function(){return this.ui.multi.length>1&&this.ui.selection.canDelete?this.deleteSelection():void 0},deleteSelection:function(){this.ui.selection&&(this.removeSelection(this.ui.selection),this.ui.multi.length&&this.ui.multi[0].focus(),this.ui.selection.refresh())},animateTo:function(e){return this.ui.selection&&this.ui.selection.animateTo(e),this},setSelect:function(e){return this.ui.selection&&this.ui.selection.update(t.wrapFromXywh(e)),this},startDrag:function(){var t=this
;return function(n){var r=e(n.target),i=r.closest("."+t.opt.css_selection).data("selection"),s=r.data("ord");return t.container.trigger("cropstart",[i,t.unscale(i.get())]),i.startDrag(n,s),!1}},getContainerSize:function(){return[this.container.width(),this.container.height()]},resizeContainer:function(e,t){this.container.width(e).height(t),this.refresh()},setImage:function(t,n){var r=this,i=r.opt.imgsrc;return i?void (new e.Jcrop.component.ImageLoader(t,null,function(s,o){r.resizeContainer(s,o),i.src=t,e(i).width(s).height(o),r.applySizeConstraints(),r.refresh(),r.container.trigger("cropimage",[r,i]),"function"==typeof n&&n.call(r,s,o)})):!1},update:function(e){this.ui.selection&&this.ui.selection.update(e)}}),e.fn.Jcrop=function(t,n){t=t||{};var r=this.eq(0).data("Jcrop"),i=Array.prototype.slice.call(arguments);return"api"==t?r:r&&"string"==typeof t?r[t]?(i.shift(),r[t].apply(r,i),r):!1:void this.each(function(){var r=e(this),i=r.data("Jcrop");return i?i.setOptions(t):(t.stageConstructor||(t.stageConstructor=e.Jcrop.stageConstructor),t.stageConstructor(this,t,function(t,i){var s=i.setSelect;s&&delete i.setSelect;var o=e.Jcrop.attach(t.element,i);"function"==typeof t.attach&&t.attach(o),r.data("Jcrop",o),s&&(o.newSelection(),o.setSelect(s)),"function"==typeof n&&n.call(o)})),this})};var N=function(e,t,n){function r(e){g.cssText=e}function i(e,t){return typeof e===t}function s(e,t){return!!~(""+e).indexOf(t)}function o(e,t){for(var r in e){var i=e[r];if(!s(i,"-")&&g[i]!==n)return"pfx"==t?i:!0}return!1}function u(e,t,r){for(var s in e){var o=t[e[s]];if(o!==n)return r===!1?e[s]:i(o,"function")?o.bind(r||t):o}return!1}function a(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+E.join(r+" ")+r).split(" ");return i(t,"string")||i(t,"undefined")?o(s,t):(s=(e+" "+S.join(r+" ")+r).split(" "),u(s,t,n))}var f,l,c,h="2.7.1",p={},d=t.documentElement,v="modernizr",m=t.createElement(v),g=m.style,y={}.toString,b=" -webkit- -moz- -o- -ms- ".split(" "),w="Webkit Moz O ms",E=w.split(" "),S=w.toLowerCase().split(" "),x={svg:"http://www.w3.org/2000/svg"},T={},N=[],C=N.slice,k=function(e,n,r,i){var s,o,u,a,f=t.createElement("div"),l=t.body,c=l||t.createElement("body");if(parseInt(r,10))for(;r--;)u=t.createElement("div"),u.id=i?i[r]:v+(r+1),f.appendChild(u);return s=["&#173;",'<style id="s',v,'">',e,"</style>"].join(""),f.id=v,(l?f:c).innerHTML+=s,c.appendChild(f),l||(c.style.background="",c.style.overflow="hidden",a=d.style.overflow,d.style.overflow="hidden",d.appendChild(c)),o=n(f,e),l?f.parentNode.removeChild(f):(c.parentNode.removeChild(c),d.style.overflow=a),!!o},L=function(){function e(e,s){s=s||t.createElement(r[e]||"div"),e="on"+e;var o=e in s;return o||(s.setAttribute||(s=t.createElement("div")),s.setAttribute&&s.removeAttribute&&(s.setAttribute(e,""),o=i(s[e],"function"),i(s[e],"undefined")||(s[e]=n),s.removeAttribute(e))),s=null,o}var r={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};return e}(),A={}.hasOwnProperty;c=i(A,"undefined")||i(A.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(e,t){return A.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=C.call(arguments,1),r=function(){if(this instanceof r){var i=function(){};i.prototype=t.prototype;var s=new i,o=t.apply(s,n.concat(C.call(arguments)));return Object(o)===o?o:s}return t.apply(e,n.concat(C.call(arguments)))};return r}),T.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},T.canvastext=function(){return!!p.canvas&&!!i(t.createElement("canvas").getContext("2d").fillText,"function")},T.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:k(["@media (",b.join("touch-enabled),("),v,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n},T.draganddrop=function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e},T.csstransforms=function(){return!!a("transform")},T.svg=function(){return!!t.createElementNS&&!!t.createElementNS(x.svg,"svg").createSVGRect},T.inlinesvg=function(){var e=t.createElement("div");return e.innerHTML="<svg/>",(e.firstChild&&e.firstChild.namespaceURI)==x.svg},T.svgclippaths=function(){return!!t.createElementNS&&/SVGClipPath/.test(y.call(t.createElementNS(x.svg,"clipPath")))};for(var O in T)c(T,O)&&(l=O.toLowerCase(),p[l]=T[O](),N.push((p[l]?"":"no-")+l));return p.addTest=function(e,t){if("object"==typeof e)for(var r in e)c(e,r)&&p.addTest(r,e[r]);else{if(e=e.toLowerCase(),p[e]!==n)return p;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(d.className+=" "+(t?"":"no-")+e),p[e]=t}return p},r(""),m=f=null,p._version=h,p._prefixes=b,p._domPrefixes=S,p._cssomPrefixes=E,p.hasEvent=L,p.testProp=function(e){return o([e])},p.testAllProps=a,p.testStyles=k,p}(window,window.document);!function(){var e=new Image;e.onerror=function(){N.addTest("datauri",function(){return!1})},e.onload=function(){N.addTest("datauri",function(){return 1==e.width&&1==e.height})},e.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="}(),e.Jcrop=t,e.Jcrop.supportsCanvas=N.canvas,e.Jcrop.supportsCanvasText=N.canvastext,e.Jcrop.supportsDragAndDrop=N.draganddrop,e.Jcrop.supportsDataURI=N.datauri,e.Jcrop.supportsSVG=N.svg,e.Jcrop.supportsInlineSVG=N.inlinesvg,e.Jcrop.supportsSVGClipPaths=N.svgclippaths,e.Jcrop.supportsCSSTransforms=N.csstransforms,e.Jcrop.supportsTouch=N.touch}(jQuery);